{% extends "index.html" %}
{% block title %}Kahmeeah Obey · Design{% endblock %}
{% block content %}
<div id="gallery-view" class="view-container active fadeIn-animation">
    <div class="gallery">
        <img src="../static/images/works/THISISNOTABRICK/cover.png" alt="THIS IS NOT A BRICK POSTER" class="item" data-project="THISISNOTABRICK">
        <img src="../static/images/works/NYCPoetryFestival/cover.png" alt="NYC POETRY FESTIVAL" class="item" data-project="NYCPoetryFestival">
        <img src="../static/images/works/flashcards/cover.png" alt="TYPOGRAPHY FLASHCARDS" class="item" data-project="flashcards">
    </div>
</div>

<div id="project-view" class="view-container">
    <div class="project-content-wrapper">
        <div id="nav-left" class="nav-zone"></div>
        <div id="nav-right" class="nav-zone"></div>

        <div class="project-body">
          
            <div class="project-left">
                <div class="image-container">
                    <img id="project-main-img" src="" alt="Project main image"/>
                </div>
                <div id="project-thumbs" class="thumb-strip"></div>
            </div>
            <div class="project-right">
              <span id="back-to-gallery" class="back-link">← Back to all</span>
                <p id="project-summary" class="summary-text"></p>
                
            </div>
        </div>
    </div>
</div>

<script>
    const projectFolders = [
        "flashcards",
        "NYCPoetryFestival",
        "THISISNOTABRICK"
    ]; // match folder names

    const projects = {};
    const detailImageNames = ["detail1.png", "detail2.png", "detail3.png", "detail4.png"]; // add as needed

    async function fileExists(url) {
        try {
            const response = await fetch(url, { method: 'HEAD' });
            return response.ok;
        } catch (error) {
            return false;
        }
    }

    async function setupProject(folder) {
        const base = `../static/images/works/${folder}/`;
        const projectImages = [base + "cover.png"];

        for (const detailName of detailImageNames) {
            const detailPath = base + detailName;
            if (await fileExists(detailPath)) {
                projectImages.push(detailPath);
            }
        }
        
        const summaryResponse = await fetch(base + "summary.txt");
        const summary = summaryResponse.ok ? await summaryResponse.text() : "Project summary is currently unavailable.";

        projects[folder] = {
            images: projectImages,
            summary: summary
        };
    }

    Promise.all(projectFolders.map(folder => setupProject(folder))).then(() => {
        console.log("All project data has been loaded and verified.");
    });

    // switch btwn gallery and closeup views
    const galleryView = document.getElementById('gallery-view');
    const projectView = document.getElementById('project-view');
    
    const projectImg = document.getElementById('project-main-img');
    const projectThumbs = document.getElementById('project-thumbs');
    const projectSummary = document.getElementById('project-summary');

    document.querySelectorAll('.gallery .item').forEach(item => {
        item.addEventListener('click', () => showProject(item.dataset.project));
    });
    
    document.getElementById('back-to-gallery').addEventListener('click', showGallery);
    document.getElementById("nav-left").addEventListener("click", prevProject);
    document.getElementById("nav-right").addEventListener("click", nextProject);

    let currentProjectName = null;

    function showProject(projectName) {
        currentProjectName = projectName;
        const project = projects[currentProjectName];
        if (!project) return;

        let currentIndex = 0;
        
        const updateImage = (index) => {
            currentIndex = index;
            projectImg.src = project.images[currentIndex];
            const activeThumb = projectThumbs.querySelector("img.active");
            if (activeThumb) activeThumb.classList.remove("active");
            projectThumbs.children[currentIndex].classList.add("active");
        };

        projectSummary.innerHTML = project.summary;
        projectThumbs.innerHTML = "";
        project.images.forEach((imgSrc, index) => {
            const thumb = document.createElement("img");
            thumb.src = imgSrc;
            thumb.draggable = false;
            thumb.setAttribute('data-pin-nopin', 'true');
            thumb.addEventListener("click", (e) => {
                e.stopPropagation();
                updateImage(index);
            });
            projectThumbs.appendChild(thumb);
        });

        updateImage(0);

        galleryView.classList.remove('active');
        projectView.classList.add('active');
        window.scrollTo(0, 0);
    }

    function showGallery() {
        projectView.classList.remove('active');
        galleryView.classList.add('active');
    }

    function prevProject() {
        let currentIdx = projectFolders.indexOf(currentProjectName);
        currentIdx = (currentIdx - 1 + projectFolders.length) % projectFolders.length;
        showProject(projectFolders[currentIdx]);
    }

    function nextProject() {
        let currentIdx = projectFolders.indexOf(currentProjectName);
        currentIdx = (currentIdx + 1) % projectFolders.length;
        showProject(projectFolders[currentIdx]);
    }

    document.addEventListener('keydown', (e) => {
        if (projectView.classList.contains('active')) {
            if (e.key === 'Escape') showGallery();
            if (e.key === 'ArrowLeft') prevProject();
            if (e.key === 'ArrowRight') nextProject();
        }
    });

</script>
{% endblock %}